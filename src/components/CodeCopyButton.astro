---
// コードブロックにコピーボタンを追加するコンポーネント
---

<script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
        const codeBlocks = document.querySelectorAll('pre');
        
        codeBlocks.forEach((preBlock) => {
            // コピーボタンのコンテナを作成
            const wrapper = document.createElement('div');
            wrapper.style.position = 'relative';
            
            // preブロックをラップ
            preBlock.parentNode.insertBefore(wrapper, preBlock);
            wrapper.appendChild(preBlock);
            
            // コピーボタンを作成
            const copyButton = document.createElement('button');
            copyButton.className = 'copy-code-button';
            copyButton.innerHTML = `
                <svg class="copy-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
                <svg class="check-icon hidden" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            `;
            
            // ボタンをクリックしたときの処理
            copyButton.addEventListener('click', async () => {
                const code = preBlock.querySelector('code')?.textContent || preBlock.textContent;
                
                try {
                    await navigator.clipboard.writeText(code);
                    
                    // アイコンを切り替え
                    const copyIcon = copyButton.querySelector('.copy-icon');
                    const checkIcon = copyButton.querySelector('.check-icon');
                    copyIcon.classList.add('hidden');
                    checkIcon.classList.remove('hidden');
                    
                    // 2秒後に元に戻す
                    setTimeout(() => {
                        copyIcon.classList.remove('hidden');
                        checkIcon.classList.add('hidden');
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy code:', err);
                }
            });
            
            wrapper.appendChild(copyButton);
        });
    });
</script>

<style is:global>
    .copy-code-button {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        padding: 0.5rem;
        background: rgba(59, 130, 246, 0.1);
        border: 1px solid rgba(59, 130, 246, 0.3);
        border-radius: 0.375rem;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #3b82f6;
        opacity: 0;
    }
    
    .copy-code-button:hover {
        background: rgba(59, 130, 246, 0.2);
        border-color: rgba(59, 130, 246, 0.5);
    }
    
    .copy-code-button:active {
        transform: scale(0.95);
    }
    
    div:has(> pre):hover .copy-code-button {
        opacity: 1;
    }
    
    .copy-code-button .hidden {
        display: none;
    }
    
    @media (max-width: 768px) {
        .copy-code-button {
            opacity: 1;
        }
    }
</style>
